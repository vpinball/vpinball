cmake_minimum_required(VERSION 3.25)

set(CMAKE_SYSTEM_NAME iOS)

option(OPT_CODESIGN "Option to code sign" OFF)

file(READ vpversion.h version)
string(REGEX MATCH "VP_VERSION_MAJOR[ ]+([0-9]+)" _tmp ${version})
set(VERSION_MAJOR "${CMAKE_MATCH_1}")
string(REGEX MATCH "VP_VERSION_MINOR[ ]+([0-9]+)" _tmp ${version})
set(VERSION_MINOR "${CMAKE_MATCH_1}")
string(REGEX MATCH "VP_VERSION_REV[ ]+([0-9]+)" _tmp ${version})
set(VERSION_REV "${CMAKE_MATCH_1}")
set(APP_NAME "VPinballX_GL")

project(vpinball VERSION "${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}")

set(CMAKE_OSX_DEPLOYMENT_TARGET 16.0)
set(CMAKE_OSX_ARCHITECTURES "arm64")

set(CMAKE_SKIP_RPATH TRUE)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_C_STANDARD 99)

add_library(glad
   third-party/include/glad/src/gles2.c
)

target_include_directories(glad PUBLIC
   third-party/include/glad/include
)

find_package(BISON 3.8.2 REQUIRED)
bison_target(vbsparser ${CMAKE_SOURCE_DIR}/standalone/inc/wine/dlls/vbscript/parser.y ${CMAKE_SOURCE_DIR}/standalone/inc/wine/dlls/vbscript/parser.tab.c 
	     DEFINES_FILE ${CMAKE_SOURCE_DIR}/standalone/inc/wine/dlls/vbscript/parser.tab.h)

add_compile_definitions(
   __STANDALONE__

   __OPENGLES__
   
   GLES_SILENCE_DEPRECATION

   ENABLE_SDL
   ENABLE_SDL_INPUT
   ENABLE_SDL_GAMECONTROLLER
   ENABLE_INI_SETTINGS

   __WINESRC__
   WINE_UNICODE_NATIVE

   WINE_NO_TRACE_MSGS
   WINE_NO_DEBUG_MSGS
)

add_definitions( 
   "-D__forceinline=__attribute__((always_inline)) inline" 
)

add_executable(vpinball
   backGlass.cpp
   backGlass.h
   bulb.cpp
   bulb.h
   codeviewedit.cpp
   codeviewedit.h
   imgui/imconfig.h
   imgui/imgui.cpp
   imgui/imgui.h
   imgui/imgui_draw.cpp
   imgui/imgui_impl_opengl3.cpp
   imgui/imgui_impl_opengl3.h
   imgui/imgui_impl_sdl2.cpp
   imgui/imgui_impl_sdl2.h
   imgui/imgui_stdlib.cpp
   imgui/imgui_stdlib.h
   imgui/imgui_tables.cpp
   imgui/imgui_widgets.cpp
   imgui/imgui_internal.h
   imgui/ImGuizmo.cpp
   imgui/ImGuizmo.h
   imgui/implot/implot.cpp
   imgui/implot/implot.h
   imgui/implot/implot_items.cpp
   imgui/implot/implot_internal.h
   third-party/include/gpuprofiler.cpp
   third-party/include/gpuprofiler.h
   third-party/include/progmesh.cpp
   third-party/include/progmesh.h
   third-party/include/ThreadPool.h
   third-party/include/mINI/ini.h
   third-party/include/tinyxml2/tinyxml2.cpp
   third-party/include/tinyxml2/tinyxml2.h
   third-party/include/miniz/miniz.c
   third-party/include/miniz/miniz.h   
   third-party/include/robin_hood.h
   third-party/include/RSJparser/RSJparser.tcc
   math/bbox.h
   math/math.cpp
   math/math.h
   math/matrix.cpp
   math/matrix.h
   math/vector.h
   media/fileio.cpp
   media/fileio.h
   media/lzwreader.cpp
   media/lzwreader.h
   media/lzwwriter.cpp
   media/lzwwriter.h
   objloader.cpp
   objloader.h
   codeview.cpp
   codeview.h
   def.cpp
   def.h
   dispid.h
   disputil.cpp
   disputil.h
   dragpoint.cpp
   dragpoint.h
   editablereg.h
   eventproxy.h
   extern.cpp
   extern.h
   hid.cpp
   hid.h
   hitrectsur.cpp
   hitrectsur.h
   hitsur.cpp
   hitsur.h
   idebug.h
   ieditable.cpp
   ieditable.h
   iselect.cpp
   iselect.h
   LiveUI.cpp
   LiveUI.h
   Material.h
   mesh.cpp
   mesh.h
   mixer.cpp
   mixer.h
   physconst.h
   pin3d.cpp
   pin3d.h
   pinbinary.cpp
   pinbinary.h
   pininput.cpp
   pininput.h
   pinundo.cpp
   pinundo.h
   plumb.cpp
   plumb.h
   variant.cpp
   variant.h
   vector.h
   vectorsort.h
   main.h
   main.cpp
   vpinball.cpp
   wintimer.cpp
   wintimer.h

   typedefs3D.h

   vpinball_h.h
   standalone/vpinball_standalone_i.c
   standalone/vpinball_standalone_i.h
   standalone/vpinball_standalone_i_proxy.cpp

   src/audio/audioplayer.cpp
   src/audio/audioplayer.h
   src/audio/pinsound.cpp
   src/audio/pinsound.h

   src/core/player.cpp
   src/core/player.h
   src/core/Settings.cpp
   src/core/Settings.h
   src/core/TableDB.cpp
   src/core/TableDB.h

   src/meshes/ballMesh.h
   src/meshes/bulbLightMesh.h
   src/meshes/bulbSocketMesh.h
   src/meshes/bumperBaseMesh.h
   src/meshes/bumperCapMesh.h
   src/meshes/bumperRingMesh.h
   src/meshes/bumperSocketMesh.h
   src/meshes/dropTargetT2Mesh.h
   src/meshes/dropTargetT3Mesh.h
   src/meshes/dropTargetT4Mesh.h
   src/meshes/flipperBase.h
   src/meshes/gateBracketMesh.h
   src/meshes/gateLongPlateMesh.h
   src/meshes/gatePlateMesh.h
   src/meshes/gateWireMesh.h
   src/meshes/gateWireRectangleMesh.h
   src/meshes/hitTargetFatRectangleMesh.h
   src/meshes/hitTargetFatSquareMesh.h
   src/meshes/hitTargetRectangleMesh.h
   src/meshes/hitTargetRoundMesh.h
   src/meshes/hitTargetT1SlimMesh.h
   src/meshes/hitTargetT2SlimMesh.h
   src/meshes/kickerCupMesh.h
   src/meshes/kickerHitMesh.h
   src/meshes/kickerHoleMesh.h
   src/meshes/kickerSimpleHoleMesh.h
   src/meshes/spinnerBracketMesh.h
   src/meshes/spinnerPlateMesh.h
   src/meshes/triggerSimpleMesh.h
   src/meshes/triggerStarMesh.h

   src/parts/ball.cpp
   src/parts/ball.h
   src/parts/bumper.cpp
   src/parts/bumper.h
   src/parts/decal.cpp
   src/parts/decal.h
   src/parts/dispreel.cpp
   src/parts/dispreel.h
   src/parts/flasher.cpp
   src/parts/flasher.h
   src/parts/flipper.cpp
   src/parts/flipper.h
   src/parts/gate.cpp
   src/parts/gate.h
   src/parts/hittarget.cpp
   src/parts/hittarget.h
   src/parts/kicker.cpp
   src/parts/kicker.h
   src/parts/light.cpp
   src/parts/light.h
   src/parts/lightseq.cpp
   src/parts/lightseq.h
   src/parts/pintable.cpp
   src/parts/pintable.h
   src/parts/plunger.cpp
   src/parts/plunger.h
   src/parts/primitive.cpp
   src/parts/primitive.h
   src/parts/ramp.cpp
   src/parts/ramp.h
   src/parts/rubber.h
   src/parts/rubber.cpp
   src/parts/spinner.cpp
   src/parts/spinner.h
   src/parts/surface.cpp
   src/parts/surface.h
   src/parts/textbox.cpp
   src/parts/textbox.h
   src/parts/timer.cpp
   src/parts/timer.h
   src/parts/trigger.cpp
   src/parts/trigger.h

   src/physics/collide.cpp
   src/physics/collide.h
   src/physics/collideex.cpp
   src/physics/collideex.h
   src/physics/hitable.h
   src/physics/hitball.cpp
   src/physics/hitball.h
   src/physics/hitflipper.cpp
   src/physics/hitflipper.h
   src/physics/hitplunger.cpp
   src/physics/hitplunger.h
   src/physics/hittimer.h
   src/physics/kdtree.cpp
   src/physics/kdtree.h
   src/physics/quadtree.cpp
   src/physics/quadtree.h

   src/renderer/Anaglyph.cpp
   src/renderer/Anaglyph.h
   src/renderer/IndexBuffer.cpp
   src/renderer/IndexBuffer.h
   src/renderer/MeshBuffer.cpp
   src/renderer/MeshBuffer.h
   src/renderer/RenderDevice.cpp
   src/renderer/RenderDevice.h
   src/renderer/RenderCommand.cpp
   src/renderer/RenderCommand.h
   src/renderer/RenderFrame.cpp
   src/renderer/RenderFrame.h
   src/renderer/RenderPass.cpp
   src/renderer/RenderPass.h
   src/renderer/RenderProbe.cpp
   src/renderer/RenderProbe.h
   src/renderer/RenderState.cpp
   src/renderer/RenderState.h
   src/renderer/RenderTarget.cpp
   src/renderer/RenderTarget.h
   src/renderer/Sampler.cpp
   src/renderer/Sampler.h
   src/renderer/Shader.cpp
   src/renderer/Shader.h
   src/renderer/Texture.cpp
   src/renderer/Texture.h
   src/renderer/TextureManager.cpp
   src/renderer/TextureManager.h
   src/renderer/VertexBuffer.cpp
   src/renderer/VertexBuffer.h
   src/renderer/ViewSetup.cpp
   src/renderer/ViewSetup.h

   standalone/inc/webserver/mongoose.c
   standalone/inc/webserver/mongoose.h
   standalone/inc/webserver/WebServer.cpp
   standalone/inc/webserver/WebServer.h

   standalone/inc/pole/pole.cpp

   standalone/PoleStream.cpp
   standalone/PoleStorage.cpp

   standalone/inc/vpinmame/VPinMAMEController.cpp
   standalone/inc/vpinmame/VPinMAMEController.h
   standalone/inc/vpinmame/VPinMAMEControllerSettings.cpp
   standalone/inc/vpinmame/VPinMAMEControllerSettings.h
   standalone/inc/vpinmame/VPinMAMEGame.cpp
   standalone/inc/vpinmame/VPinMAMEGame.h
   standalone/inc/vpinmame/VPinMAMEGames.cpp
   standalone/inc/vpinmame/VPinMAMEGames.h
   standalone/inc/vpinmame/VPinMAMEGameSettings.cpp
   standalone/inc/vpinmame/VPinMAMEGameSettings.h
   standalone/inc/vpinmame/VPinMAMERom.cpp
   standalone/inc/vpinmame/VPinMAMERom.h
   standalone/inc/vpinmame/VPinMAMERoms.cpp
   standalone/inc/vpinmame/VPinMAMERoms.h
   standalone/inc/vpinmame/vpinmame_i_proxy.cpp
   standalone/inc/vpinmame/vpinmame_i.c
   standalone/inc/vpinmame/vpinmame_i.h

   standalone/inc/wmp/WMPCore.cpp
   standalone/inc/wmp/WMPCore.h
   standalone/inc/wmp/WMPControls.cpp
   standalone/inc/wmp/WMPControls.h
   standalone/inc/wmp/WMPSettings.cpp
   standalone/inc/wmp/WMPSettings.h
   standalone/inc/wmp/wmp_i_proxy.cpp
   standalone/inc/wmp/wmp_i.c
   standalone/inc/wmp/wmp_i.h

   standalone/inc/ultradmd/UltraDMDDMDObject.cpp
   standalone/inc/ultradmd/UltraDMDDMDObject.h
   standalone/inc/ultradmd/ultradmd_i_proxy.cpp
   standalone/inc/ultradmd/ultradmd_i.c
   standalone/inc/ultradmd/ultradmd_i.h

   standalone/inc/flexdmd/actions/ActionFactory.cpp
   standalone/inc/flexdmd/actions/ActionFactory.h
   standalone/inc/flexdmd/actions/Action.cpp
   standalone/inc/flexdmd/actions/Action.h
   standalone/inc/flexdmd/actions/RepeatAction.cpp
   standalone/inc/flexdmd/actions/RepeatAction.h
   standalone/inc/flexdmd/actions/SequenceAction.cpp
   standalone/inc/flexdmd/actions/SequenceAction.h
   standalone/inc/flexdmd/actions/ParallelAction.cpp
   standalone/inc/flexdmd/actions/ParallelAction.h
   standalone/inc/flexdmd/actions/ShowAction.cpp
   standalone/inc/flexdmd/actions/ShowAction.h
   standalone/inc/flexdmd/actions/BlinkAction.cpp
   standalone/inc/flexdmd/actions/BlinkAction.h
   standalone/inc/flexdmd/actions/AddToAction.cpp
   standalone/inc/flexdmd/actions/AddToAction.h
   standalone/inc/flexdmd/actions/RemoveFromParentAction.cpp
   standalone/inc/flexdmd/actions/RemoveFromParentAction.h
   standalone/inc/flexdmd/actions/AddChildAction.cpp
   standalone/inc/flexdmd/actions/AddChildAction.h
   standalone/inc/flexdmd/actions/SeekAction.cpp
   standalone/inc/flexdmd/actions/SeekAction.h
   standalone/inc/flexdmd/actions/WaitAction.cpp
   standalone/inc/flexdmd/actions/WaitAction.h
   standalone/inc/flexdmd/actions/DelayedAction.cpp
   standalone/inc/flexdmd/actions/DelayedAction.h
   standalone/inc/flexdmd/actions/TweenAction.cpp
   standalone/inc/flexdmd/actions/TweenAction.h
   standalone/inc/flexdmd/actions/MoveToAction.cpp
   standalone/inc/flexdmd/actions/MoveToAction.h
   standalone/inc/flexdmd/actors/Actor.cpp
   standalone/inc/flexdmd/actors/Actor.h
   standalone/inc/flexdmd/actors/AnimatedActor.cpp
   standalone/inc/flexdmd/actors/AnimatedActor.h
   standalone/inc/flexdmd/actors/ImageSequence.cpp
   standalone/inc/flexdmd/actors/ImageSequence.h
   standalone/inc/flexdmd/actors/GIFImage.cpp
   standalone/inc/flexdmd/actors/GIFImage.h
   standalone/inc/flexdmd/actors/Font.cpp
   standalone/inc/flexdmd/actors/Font.h
   standalone/inc/flexdmd/actors/Frame.cpp
   standalone/inc/flexdmd/actors/Frame.h
   standalone/inc/flexdmd/actors/FadeOverlay.cpp
   standalone/inc/flexdmd/actors/FadeOverlay.h
   standalone/inc/flexdmd/actors/Group.cpp
   standalone/inc/flexdmd/actors/Group.h
   standalone/inc/flexdmd/actors/Image.cpp
   standalone/inc/flexdmd/actors/Image.h
   standalone/inc/flexdmd/actors/Label.cpp
   standalone/inc/flexdmd/actors/Label.h
   standalone/inc/flexdmd/actors/Video.cpp
   standalone/inc/flexdmd/actors/Video.h
   standalone/inc/flexdmd/filters/BitmapFilter.cpp
   standalone/inc/flexdmd/filters/BitmapFilter.h
   standalone/inc/flexdmd/filters/RegionFilter.cpp
   standalone/inc/flexdmd/filters/RegionFilter.h
   standalone/inc/flexdmd/filters/PadFilter.cpp
   standalone/inc/flexdmd/filters/PadFilter.h
   standalone/inc/flexdmd/filters/DotFilter.cpp
   standalone/inc/flexdmd/filters/DotFilter.h
   standalone/inc/flexdmd/filters/AdditiveFilter.cpp
   standalone/inc/flexdmd/filters/AdditiveFilter.h
   standalone/inc/flexdmd/FlexDMD.cpp
   standalone/inc/flexdmd/FlexDMD.h
   standalone/inc/flexdmd/AssetSrc.cpp
   standalone/inc/flexdmd/AssetSrc.h
   standalone/inc/flexdmd/AssetManager.cpp
   standalone/inc/flexdmd/AssetManager.h
   standalone/inc/flexdmd/Bitmap.cpp
   standalone/inc/flexdmd/Bitmap.h
   standalone/inc/flexdmd/Layout.cpp
   standalone/inc/flexdmd/Layout.h
   standalone/inc/flexdmd/UltraDMD.cpp
   standalone/inc/flexdmd/UltraDMD.h
   standalone/inc/flexdmd/FontDef.cpp
   standalone/inc/flexdmd/FontDef.h
   standalone/inc/flexdmd/ImageSequenceDef.cpp
   standalone/inc/flexdmd/ImageSequenceDef.h
   standalone/inc/flexdmd/VideoDef.cpp
   standalone/inc/flexdmd/VideoDef.h
   standalone/inc/flexdmd/actors/ScoreBoard.cpp
   standalone/inc/flexdmd/actors/ScoreBoard.h
   standalone/inc/flexdmd/scenes/AnimationType.h
   standalone/inc/flexdmd/scenes/Scene.cpp
   standalone/inc/flexdmd/scenes/Scene.h
   standalone/inc/flexdmd/scenes/Sequence.cpp
   standalone/inc/flexdmd/scenes/Sequence.h
   standalone/inc/flexdmd/scenes/SingleLineScene.cpp
   standalone/inc/flexdmd/scenes/SingleLineScene.h
   standalone/inc/flexdmd/scenes/TwoLineScene.cpp
   standalone/inc/flexdmd/scenes/TwoLineScene.h
   standalone/inc/flexdmd/scenes/BackgroundScene.cpp
   standalone/inc/flexdmd/scenes/BackgroundScene.h
   standalone/inc/flexdmd/scenes/ScrollingCreditsScene.cpp
   standalone/inc/flexdmd/scenes/ScrollingCreditsScene.h
   standalone/inc/flexdmd/flexudmd_i_proxy.cpp
   standalone/inc/flexdmd/flexudmd_i.c
   standalone/inc/flexdmd/flexudmd_i.h
   standalone/inc/flexdmd/flexdmd_i_proxy.cpp
   standalone/inc/flexdmd/flexdmd_i.c
   standalone/inc/flexdmd/flexdmd_i.h
   standalone/inc/flexdmd/bmfonts/BitmapFont.cpp
   standalone/inc/flexdmd/bmfonts/BitmapFont.h
   standalone/inc/flexdmd/bmfonts/Character.cpp
   standalone/inc/flexdmd/bmfonts/Character.h
   standalone/inc/flexdmd/bmfonts/Kerning.cpp
   standalone/inc/flexdmd/bmfonts/Kerning.h
   standalone/inc/flexdmd/bmfonts/Page.cpp
   standalone/inc/flexdmd/bmfonts/Page.h

   standalone/inc/b2s/classes/AnimationInfo.cpp
   standalone/inc/b2s/classes/AnimationInfo.h
   standalone/inc/b2s/classes/B2SAnimation.cpp
   standalone/inc/b2s/classes/B2SAnimation.h
   standalone/inc/b2s/classes/B2SAnimationBase.cpp
   standalone/inc/b2s/classes/B2SAnimationBase.h
   standalone/inc/b2s/classes/B2SCollectData.cpp
   standalone/inc/b2s/classes/B2SCollectData.h
   standalone/inc/b2s/classes/B2SData.cpp
   standalone/inc/b2s/classes/B2SData.h
   standalone/inc/b2s/classes/B2SPlayer.cpp
   standalone/inc/b2s/classes/B2SPlayer.h
   standalone/inc/b2s/classes/B2SScreen.cpp
   standalone/inc/b2s/classes/B2SScreen.h
   standalone/inc/b2s/classes/B2SSettings.cpp
   standalone/inc/b2s/classes/B2SSettings.h
   standalone/inc/b2s/classes/B2SReelDisplay.cpp
   standalone/inc/b2s/classes/B2SReelDisplay.h
   standalone/inc/b2s/classes/CollectData.cpp
   standalone/inc/b2s/classes/CollectData.h
   standalone/inc/b2s/classes/ControlInfo.cpp
   standalone/inc/b2s/classes/ControlInfo.h
   standalone/inc/b2s/classes/EntryAction.cpp
   standalone/inc/b2s/classes/EntryAction.h
   standalone/inc/b2s/classes/LEDAreaInfo.cpp
   standalone/inc/b2s/classes/LEDAreaInfo.h
   standalone/inc/b2s/classes/LEDDisplayDigitLocation.cpp
   standalone/inc/b2s/classes/LEDDisplayDigitLocation.h
   standalone/inc/b2s/classes/PictureBoxAnimation.cpp
   standalone/inc/b2s/classes/PictureBoxAnimation.h
   standalone/inc/b2s/classes/PictureBoxAnimationEntry.cpp
   standalone/inc/b2s/classes/PictureBoxAnimationEntry.h
   standalone/inc/b2s/classes/Sound.cpp
   standalone/inc/b2s/classes/Sound.h
   standalone/inc/b2s/collections/AnimationCollection.cpp
   standalone/inc/b2s/collections/AnimationCollection.h
   standalone/inc/b2s/collections/ControlCollection.cpp
   standalone/inc/b2s/collections/ControlCollection.h
   standalone/inc/b2s/collections/GenericDictionaryIgnoreCase.cpp
   standalone/inc/b2s/collections/GenericDictionaryIgnoreCase.h
   standalone/inc/b2s/collections/IlluminationGroupCollection.cpp
   standalone/inc/b2s/collections/IlluminationGroupCollection.h
   standalone/inc/b2s/collections/PictureBoxCollection.cpp
   standalone/inc/b2s/collections/PictureBoxCollection.h
   standalone/inc/b2s/collections/ReelDisplayReelBoxCollection.cpp
   standalone/inc/b2s/collections/ReelDisplayReelBoxCollection.h
   standalone/inc/b2s/collections/ReelBoxCollection.cpp
   standalone/inc/b2s/collections/ReelBoxCollection.h
   standalone/inc/b2s/collections/RunningAnimationsCollection.cpp
   standalone/inc/b2s/collections/RunningAnimationsCollection.h
   standalone/inc/b2s/collections/ZOrderCollection.cpp
   standalone/inc/b2s/collections/ZOrderCollection.h
   standalone/inc/b2s/controls/B2SBaseBox.cpp
   standalone/inc/b2s/controls/B2SBaseBox.h
   standalone/inc/b2s/controls/B2SLEDBox.cpp
   standalone/inc/b2s/controls/B2SLEDBox.h
   standalone/inc/b2s/controls/B2SPictureBox.cpp
   standalone/inc/b2s/controls/B2SPictureBox.h
   standalone/inc/b2s/controls/B2SReelBox.cpp
   standalone/inc/b2s/controls/B2SReelBox.h
   standalone/inc/b2s/controls/Control.cpp
   standalone/inc/b2s/controls/Control.h
   standalone/inc/b2s/dream7/Dream7Display.cpp
   standalone/inc/b2s/dream7/Dream7Display.h
   standalone/inc/b2s/dream7/Segment.cpp
   standalone/inc/b2s/dream7/Segment.h
   standalone/inc/b2s/dream7/SegmentList.cpp
   standalone/inc/b2s/dream7/SegmentList.h
   standalone/inc/b2s/dream7/SegmentNumber.cpp
   standalone/inc/b2s/dream7/SegmentNumber.h
   standalone/inc/b2s/dream7/SegmentStyle.cpp
   standalone/inc/b2s/dream7/SegmentStyle.h
   standalone/inc/b2s/forms/FormWindow.cpp
   standalone/inc/b2s/forms/FormWindow.h
   standalone/inc/b2s/forms/Form.cpp
   standalone/inc/b2s/forms/Form.h
   standalone/inc/b2s/forms/FormBackglass.cpp
   standalone/inc/b2s/forms/FormBackglass.h
   standalone/inc/b2s/forms/FormDMD.cpp
   standalone/inc/b2s/forms/FormDMD.h
   standalone/inc/b2s/plugin/Plugin.cpp
   standalone/inc/b2s/plugin/Plugin.h
   standalone/inc/b2s/plugin/PluginHost.cpp
   standalone/inc/b2s/plugin/PluginHost.h
   standalone/inc/b2s/Server.cpp
   standalone/inc/b2s/Server.h
   standalone/inc/b2s/b2s_i_proxy.cpp
   standalone/inc/b2s/b2s_i.c
   standalone/inc/b2s/b2s_i.h

   standalone/inc/dof/DOFPlugin.cpp
   standalone/inc/dof/DOFPlugin.h

   standalone/Standalone.cpp
   standalone/Standalone.h

   standalone/inc/pup/PUPManager.cpp
   standalone/inc/pup/PUPManager.h
   standalone/inc/pup/PUPPinDisplay.cpp
   standalone/inc/pup/PUPPinDisplay.h
   standalone/inc/pup/PUPPlaylist.cpp
   standalone/inc/pup/PUPPlaylist.h
   standalone/inc/pup/PUPTrigger.cpp
   standalone/inc/pup/PUPTrigger.h
   standalone/inc/pup/PUPScreen.cpp
   standalone/inc/pup/PUPScreen.h
   standalone/inc/pup/PUPLabel.cpp
   standalone/inc/pup/PUPLabel.h
   standalone/inc/pup/PUPCustomPos.cpp
   standalone/inc/pup/PUPCustomPos.h
   standalone/inc/pup/PUPPlugin.cpp
   standalone/inc/pup/PUPPlugin.h
   standalone/inc/pup/PUPWindow.cpp
   standalone/inc/pup/PUPWindow.h
   standalone/inc/pup/pup_i_proxy.cpp
   standalone/inc/pup/pup_i.c
   standalone/inc/pup/pup_i.h

   standalone/inc/common/WindowManager.cpp
   standalone/inc/common/WindowManager.h
   standalone/inc/common/Window.cpp
   standalone/inc/common/Window.h
   standalone/inc/common/DMDWindow.cpp
   standalone/inc/common/DMDWindow.h
   standalone/inc/common/RendererGraphics.cpp
   standalone/inc/common/RendererGraphics.h
   standalone/inc/common/SurfaceGraphics.cpp
   standalone/inc/common/SurfaceGraphics.h
   standalone/inc/common/GraphicsPath.cpp
   standalone/inc/common/GraphicsPath.h
   standalone/inc/common/Matrix.cpp
   standalone/inc/common/Matrix.h
   standalone/inc/common/Timer.cpp
   standalone/inc/common/Timer.h

   standalone/inc/wine/dlls/atl/atl.c

   standalone/inc/wine/dlls/oleaut32/oleaut.c
   standalone/inc/wine/dlls/oleaut32/variant.c
   standalone/inc/wine/dlls/oleaut32/varformat.c
   standalone/inc/wine/dlls/oleaut32/vartype.c
   standalone/inc/wine/dlls/oleaut32/safearray.c

   standalone/inc/wine/dlls/vbscript/compile.c
   standalone/inc/wine/dlls/vbscript/global.c
   standalone/inc/wine/dlls/vbscript/interp.c
   standalone/inc/wine/dlls/vbscript/lex.c
   standalone/inc/wine/dlls/vbscript/regexp.c
   standalone/inc/wine/dlls/vbscript/utils.c
   standalone/inc/wine/dlls/vbscript/vbdisp.c
   standalone/inc/wine/dlls/vbscript/vbregexp.c
   standalone/inc/wine/dlls/vbscript/vbscript.c
   standalone/inc/wine/dlls/vbscript/vbscript_main.c
   standalone/inc/wine/dlls/vbscript/parser.tab.c

   standalone/inc/wine/dlls/scrrun/dictionary.c
   standalone/inc/wine/dlls/scrrun/filesystem.c
   standalone/inc/wine/dlls/scrrun/scrrun.c

   standalone/inc/wine/dlls/kernelbase/locale.c

   standalone/inc/wine/wine.c

   standalone/ios-arm64/ios-project/sdl_main.c
)

target_sources(vpinball PRIVATE
    standalone/ios-arm64/ios-project/assets
    standalone/ios-arm64/ios-project/Assets.xcassets
    standalone/ios-arm64/ios-project/LaunchScreen.storyboard
)

set_source_files_properties(
    standalone/ios-arm64/ios-project/assets
    standalone/ios-arm64/ios-project/Assets.xcassets
    standalone/ios-arm64/ios-project/LaunchScreen.storyboard

    PROPERTIES MACOSX_PACKAGE_LOCATION Resources
)

target_include_directories(vpinball PUBLIC
   ${CMAKE_SOURCE_DIR}/standalone/ios-arm64/external/include
   ${CMAKE_SOURCE_DIR}/standalone/ios-arm64/external/include/SDL2
   ${CMAKE_SOURCE_DIR}
   third-party/include
   standalone/inc/pole
   standalone/inc/wine/include
   standalone/inc/wine/dlls/atl
   standalone/inc/wine/dlls/vbscript
   standalone/inc/wine/dlls/oleaut32
   standalone/inc/wine/dlls/kernelbase
   media
   pin
   src
)

target_precompile_headers(vpinball PUBLIC
)

target_compile_options(vpinball PUBLIC
   -fvisibility=hidden
   -Wno-inconsistent-missing-override
   -Wno-missing-exception-spec
   $<$<OR:$<CXX_COMPILER_ID:Clang>,$<CXX_COMPILER_ID:AppleClang>>:
      -fdenormal-fp-math=preserve-sign
      -freciprocal-math
      -fassociative-math
      -fapprox-func
      -fno-math-errno
      -fno-trapping-math
      -ffp-contract=off
      -Wno-shorten-64-to-32>
   $<$<CXX_COMPILER_ID:GNU>:
      -ffast-math
      -ffp-contract=off>
)

target_link_directories(vpinball PUBLIC
   "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/external/lib"
)

target_link_libraries(vpinball PUBLIC
   glad
   "-lSDL2"
   "-lSDL2_image"
   "-lSDL2_ttf"
   "-lfreeimage"
   "-framework Bass"
   "-lpinmame.3.6"
   "-laltsound"
   "-lzedmd"
   "-lserum"
   "-ldmdutil"
   "-lpupdmd"
   "-lsockpp"
   "-ldof"
   "-framework OpenGLES"
   "-framework AVFAudio"
   "-framework Metal"
   "-framework Foundation"
   "-framework QuartzCore"
   "-framework CoreMotion"
   "-framework CoreGraphics"
   "-framework GameController"
   "-framework AudioToolbox"
   "-framework CoreAudio"
   "-framework CoreHaptics"
   "-framework CoreServices"
   "-framework ImageIO"
   "-framework UIKit"
)

set(TARGET_PROPERTIES
   MACOSX_BUNDLE YES
   MACOSX_BUNDLE_INFO_PLIST "standalone/ios-arm64/ios-project/Info.plist"
   MACOSX_BUNDLE_EXECUTABLE_NAME "${APP_NAME}" 
   XCODE_ATTRIBUTE_ASSETCATALOG_COMPILER_APPICON_NAME "AppIcon"
   XCODE_ATTRIBUTE_LAUNCH_STORYBOARD_NAME "standalone/ios-arm64/ios-project/LaunchScreen.storyboard"
   XCODE_ATTRIBUTE_TARGETED_DEVICE_FAMILY "1,2"
   XCODE_ATTRIBUTE_CLANG_ENABLE_OBJC_ARC YES
   XCODE_ATTRIBUTE_COMBINE_HIDPI_IMAGES "NO"
   XCODE_ATTRIBUTE_PRODUCT_NAME "${APP_NAME}"
   XCODE_ATTRIBUTE_PRODUCT_BUNDLE_IDENTIFIER "org.vpinball.vpinballx-gl"
   XCODE_ATTRIBUTE_CURRENT_PROJECT_VERSION "${CMAKE_PROJECT_VERSION}"
   XCODE_ATTRIBUTE_MARKETING_VERSION "${CMAKE_PROJECT_VERSION}"
   XCODE_ATTRIBUTE_INSTALL_PATH "/Applications"
   XCODE_ATTRIBUTE_FRAMEWORK_SEARCH_PATHS "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/external/framework"
   XCODE_ATTRIBUTE_LD_RUNPATH_SEARCH_PATHS "@executable_path/Frameworks"
   XCODE_EMBED_FRAMEWORKS "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/external/framework/bass.framework"
   XCODE_ATTRIBUTE_CODE_SIGN_ENTITLEMENTS "standalone/ios-arm64/ios-project/App.entitlements"
)

if(OPT_CODESIGN)
    list(APPEND TARGET_PROPERTIES
      XCODE_ATTRIBUTE_DEVELOPMENT_TEAM ""
      XCODE_ATTRIBUTE_CODE_SIGN_IDENTITY "iPhone Developer"
      XCODE_EMBED_FRAMEWORKS_CODE_SIGN_ON_COPY ON
   )
else()
    list(APPEND TARGET_PROPERTIES
      XCODE_ATTRIBUTE_CODE_SIGNING_REQUIRED NO
      XCODE_ATTRIBUTE_CODE_SIGNING_ALLOWED NO
   )
endif()

set_target_properties(vpinball PROPERTIES ${TARGET_PROPERTIES})

add_custom_command(TARGET vpinball PRE_BUILD
   COMMAND "${CMAKE_COMMAND}" -E copy_directory "${CMAKE_SOURCE_DIR}/src/assets" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/assets"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/Default_VPinballX.ini" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/assets"
   COMMAND "${CMAKE_COMMAND}" -E copy_directory "${CMAKE_SOURCE_DIR}/scripts" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/scripts"
   COMMAND "${CMAKE_COMMAND}" -E copy_directory "${CMAKE_SOURCE_DIR}/tables" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/tables"
   COMMAND "${CMAKE_COMMAND}" -E make_directory "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/BasicShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/DMDShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/FBShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/SMAA.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/FlasherShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/LightShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/BallShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/ClassicLightShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/StereoShader.glfx" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/Helpers.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/FBShader.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/Material_GL.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/BallShadows.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/SMAA.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/FXAAStereoAO_GL.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/SSR_GL.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy "${CMAKE_SOURCE_DIR}/shader/Stereo.fxh" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/shader${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_REV}"
   COMMAND "${CMAKE_COMMAND}" -E copy_directory "${CMAKE_SOURCE_DIR}/standalone/inc/flexdmd/resources" "${CMAKE_SOURCE_DIR}/standalone/ios-arm64/ios-project/assets/flexdmd"
)
